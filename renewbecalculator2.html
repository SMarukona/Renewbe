<!-- chartjs integration-->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

// Panel data is taken from the Google sheet
const pannelData = [
    {
        "Amount of Solar Panels": 1,
        "Wattage": 410,
        "Real Wattage": 328,
        "Tilted": { "Micro (x4)": 0, "String": 0 },
        "Flat": { "Micro (x4)": 0, "String": 0 }
    },
    {
        "Amount of Solar Panels": 2,
        "Wattage": 820,
        "Real Wattage": 656,
        "Tilted": { "Micro (x4)": 2366, "String": 1831 },
        "Flat": { "Micro (x4)": 2446, "String": 1853 }
    },
    {
        "Amount of Solar Panels": 3,
        "Wattage": 1230,
        "Real Wattage": 984,
        "Tilted": { "Micro (x4)": 2881, "String": 2292 },
        "Flat": { "Micro (x4)": 2987, "String": 2327 }
    },
    {
        "Amount of Solar Panels": 4,
        "Wattage": 1640,
        "Real Wattage": 1312,
        "Tilted": { "Micro (x4)": 3482, "String": 2753 },
        "Flat": { "Micro (x4)": 3528, "String": 2797 }
    },
    {
        "Amount of Solar Panels": 5,
        "Wattage": 2050,
        "Real Wattage": 1640,
        "Tilted": { "Micro (x4)": 4011, "String": 3214 },
        "Flat": { "Micro (x4)": 4067, "String": 3269 }
    },
    {
        "Amount of Solar Panels": 6,
        "Wattage": 2460,
        "Real Wattage": 1968,
        "Tilted": { "Micro (x4)": 4492, "String": 3626 },
        "Flat": { "Micro (x4)": 4561, "String": 3694 }
    },
    {
        "Amount of Solar Panels": 7,
        "Wattage": 2870,
        "Real Wattage": 2296,
        "Tilted": { "Micro (x4)": 4976, "String": 4039 },
        "Flat": { "Micro (x4)": 5055, "String": 4118 }
    },
    {
        "Amount of Solar Panels": 8,
        "Wattage": 3280,
        "Real Wattage": 2624,
        "Tilted": { "Micro (x4)": 5457, "String": 4452 },
        "Flat": { "Micro (x4)": 5548, "String": 4542 }
    },
    {
        "Amount of Solar Panels": 9,
        "Wattage": 3690,
        "Real Wattage": 2952,
        "Tilted": { "Micro (x4)": 5907, "String": 4864 },
        "Flat": { "Micro (x4)": 6041, "String": 4966 }
    },
    {
        "Amount of Solar Panels": 10,
        "Wattage": 4100,
        "Real Wattage": 3280,
        "Tilted": { "Micro (x4)": 6421, "String": 5278 },
        "Flat": { "Micro (x4)": 6536, "String": 5390 }
    },
    {
        "Amount of Solar Panels": 11,
        "Wattage": 4510,
        "Real Wattage": 3608,
        "Tilted": { "Micro (x4)": 6904, "String": 5690 },
        "Flat": { "Micro (x4)": 7029, "String": 5715 }
    },
    {
        "Amount of Solar Panels": 12,
        "Wattage": 4920,
        "Real Wattage": 3936,
        "Tilted": { "Micro (x4)": 7385, "String": 6102 },
        "Flat": { "Micro (x4)": 7522, "String": 6239 }
    },
    {
        "Amount of Solar Panels": 13,
        "Wattage": 5330,
        "Real Wattage": 4264,
        "Tilted": { "Micro (x4)": 7868, "String": 6516 },
        "Flat": { "Micro (x4)": 8015, "String": 6664 }
    },
    {
        "Amount of Solar Panels": 14,
        "Wattage": 5740,
        "Real Wattage": 4592,
        "Tilted": { "Micro (x4)": 8350, "String": 6928 },
        "Flat": { "Micro (x4)": 8510, "String": 7087 }
    },
    {
        "Amount of Solar Panels": 15,
        "Wattage": 6150,
        "Real Wattage": 4920,
        "Tilted": { "Micro (x4)": 8806, "String": 7318 },
        "Flat": { "Micro (x4)": 8976, "String": 7488 }
    },
    {
        "Amount of Solar Panels": 16,
        "Wattage": 6560,
        "Real Wattage": 5248,
        "Tilted": { "Micro (x4)": 9288, "String": 7730 },
        "Flat": { "Micro (x4)": 9468, "String": 7911 }
    },
    {
        "Amount of Solar Panels": 17,
        "Wattage": 6970,
        "Real Wattage": 5576,
        "Tilted": { "Micro (x4)": 9768, "String": 8141},
        "Flat": { "Micro (x4)": 9959, "String": 8334}
    },
    {
        "Amount of Solar Panels": 18,
        "Wattage": 7380,
        "Real Wattage": 5904,
        "Tilted": { "Micro (x4)": 10249, "String": 10249 },
        "Flat": { "Micro (x4)": 10452, "String": 8757 }
    },
    {
        "Amount of Solar Panels": 19,
        "Wattage": 7790,
        "Real Wattage": 6232,
        "Tilted": { "Micro (x4)": 10729, "String": 8963 },
        "Flat": { "Micro (x4)": 10943, "String": 9179 }
    },
    {
        "Amount of Solar Panels": 20,
        "Wattage": 8200,
        "Real Wattage": 6560,
        "Tilted": { "Micro (x4)": 11211, "String": 9376 },
        "Flat": { "Micro (x4)": 11453, "String": 9601 }
    },
    {
        "Amount of Solar Panels": 21,
        "Wattage": 8610,
        "Real Wattage": 6888,
        "Tilted": { "Micro (x4)": 11691, "String": 9787 },
        "Flat": { "Micro (x4)": 11927, "String": 10024 }
    },
    {
        "Amount of Solar Panels": 22,
        "Wattage": 9020,
        "Real Wattage": 7216,
        "Tilted": { "Micro (x4)": 12139, "String": 10142 },
        "Flat": { "Micro (x4)": 12387, "String": 10392 }
    }
    
];

// Creating step count
const stepCount = 9;
const steps = Array.from({ length: stepCount }, (_, index) => document.getElementById(`step${index + 1}`));
const backs = Array.from({ length: stepCount - 1 }, (_, index) => document.getElementById(`back${index + 2}`));
const nextButtons = Array.from({ length: stepCount - 1 }, (_, index) => document.getElementById(`next${index + 1}`));

// Next button click event
function handleNextClick(stepIndex) {
  steps[stepIndex].classList.add('more_left');
  steps[stepIndex + 1].classList.remove('more_right');
}

// Add click event listeners for back buttons
for (let stepIndex = 0; stepIndex < stepCount - 1; stepIndex++) {
  nextButtons[stepIndex].classList.add('disabled');

  backs[stepIndex].addEventListener('click', () => {
    steps[stepIndex].classList.remove('more_left');
    steps[stepIndex + 1].classList.add('more_right');
  });
}

// Common function to enable/disable next button
function enableNextButton(index) {
  nextButtons[index].classList.remove('disabled');
  nextButtons[index].addEventListener('click', () => handleNextClick(index));
}

function disableNextButton(index) {
  nextButtons[index].classList.add('disabled');
  nextButtons[index].removeEventListener('click', () => handleNextClick(index));
}

// Step 1
const propertyRadioGroup = document.getElementsByName('property');
const warningTextStep1 = document.getElementById('w_step1');
const rentRadio = document.getElementById('rent');
const ownerRadio = document.getElementById('owner-2');

function updateNextButtonState0() {
  if (rentRadio.checked) {
    nextButtons[0].classList.add('disabled');
    warningTextStep1.style.display = 'block';
    disableNextButton(0);
  } else if (ownerRadio.checked) {
    nextButtons[0].classList.remove('disabled');
    warningTextStep1.style.display = 'none';
    enableNextButton(0);
  }
}

propertyRadioGroup.forEach(radio => {
  radio.addEventListener("change", updateNextButtonState0);
});

// Step 2
const slopeRadioGroup = document.getElementsByName('slope');
const flatRoofText = document.getElementById('flat_roof-text');
const flatRadio = document.getElementById('flat');
const tiltedRadio = document.getElementById('tilted');

function updateNextButtonState1() {
  if (flatRadio.checked || tiltedRadio.checked) {
    nextButtons[1].classList.remove('disabled');
    enableNextButton(1);
    console.log("checked");
  } else {
    nextButtons[1].classList.add('disabled');
    disableNextButton(1);
  }
}

slopeRadioGroup.forEach(radio => {
  radio.addEventListener("change", updateNextButtonState1);
});



// Step 3
const materiialRadioGroup = document.getElementsByName('material');
const roofMaterialText = document.getElementById('roof_material-text');
const caneRadio = document.getElementById('cane');
const slatedRadio = document.getElementById('slated');
const tilesRadio = document.getElementById('tiles');
const zincRadio = document.getElementById('zinc');

function updateNextButtonState2() {
  if (caneRadio.checked) {
    nextButtons[2].classList.add('disabled');
    roofMaterialText.style.display = 'block';
    disableNextButton(2);
  } else if (slatedRadio.checked || tilesRadio.checked || zincRadio.checked) {
    nextButtons[2].classList.remove('disabled');
    roofMaterialText.style.display = 'none';
    enableNextButton(2);
  }
}

materiialRadioGroup.forEach(radio => {
  radio.addEventListener("change", updateNextButtonState2);
});



/*
materiialRadioGroup.forEach(radio => {
  radio.addEventListener("change", () => {
    if (caneRadio.checked) {
      roofMaterialText.style.display = "block";
      nextButtons[2].classList.add("disabled");
      nextButtons[2].removeEventListener('click', handleNextClick);
    } else {
      roofMaterialText.style.display = "none";
      nextButtons[2].classList.remove("disabled");
      nextButtons[2].addEventListener('click', () => {
        if (!caneRadio.checked) {
          handleNextClick(2);
        }
      });
    }
  });
});*/




// Step 4
const orientationRadioButtons = document.getElementsByName("orientation");
const northRadio = document.getElementById('north');
const eastRadio = document.getElementById('east');
const westRadio = document.getElementById('west');
const southRadio = document.getElementById('south');

function updateNextButtonState3() {
  if (northRadio.checked || eastRadio.checked || westRadio.checked || southRadio.checked) {
    nextButtons[3].classList.remove('disabled');
    enableNextButton(3);
  } else {
    nextButtons[3].classList.add('disabled');
    disableNextButton(3);
  }
}

orientationRadioButtons.forEach(radio => {
  radio.addEventListener("change", updateNextButtonState3);
});



// Step 5
const roofShadeRadioButtons = document.getElementsByName("shade");
const yesRadio = document.getElementById('yes');
const noRadio = document.getElementById('no');

function updateNextButtonState4() {
  if (yesRadio.checked || noRadio.checked) {
    nextButtons[4].classList.remove('disabled');
    enableNextButton(4);
  } else {
    nextButtons[4].classList.add('disabled');
    disableNextButton(4);
  }
}

roofShadeRadioButtons.forEach(radio => {
  radio.addEventListener("change", updateNextButtonState4);
});


// Step 6
const floorCountRadioGroup = document.getElementsByName('floorcount');
const floorCountText = document.getElementById('prop_count-text');
const count1Radio = document.getElementById('count1');
const count2Radio = document.getElementById('count2');
const count2MoreRadio = document.getElementById('count2more');

function updateNextButtonState5() {
  if (count1Radio.checked || count2Radio.checked || count2MoreRadio.checked) {
    nextButtons[5].classList.remove('disabled');
    enableNextButton(5);
  } else {
    nextButtons[5].classList.add('disabled');
    disableNextButton(5);
  }
}

floorCountRadioGroup.forEach(radio => {
  radio.addEventListener("change", updateNextButtonState5);
});


// Step 7
const yearRadioButtons = document.getElementsByName("discount");
const discountindicationText = document.getElementById('when_text');
const before2014Radio = document.getElementById('before_2014');
const after2014Radio = document.getElementById('after_2014');

function updateNextButtonState6() {
  if (before2014Radio.checked || after2014Radio.checked) {
    nextButtons[6].classList.remove('disabled');
    enableNextButton(6);
  } else {
    nextButtons[6].classList.add('disabled');
    disableNextButton(6);
  }
}

yearRadioButtons.forEach(radio => {
  radio.addEventListener("change", updateNextButtonState6);
});


//Step 8
nextButtons[7].addEventListener('click', () => handleNextClick(7));
nextButtons[7].classList.remove('disabled');

// Step 9
const formName = document.getElementById('Name');
const formPostalCode = document.getElementById('Postal-Code-3');
const formEmail = document.getElementById('Your-Email');
const formPhone = document.getElementById('Your-Phone');
const next9 = document.getElementById('next9');

// Function to check if all fields have values
function doAllFieldsHaveValues() {
  return (
    formName.value.trim() !== '' &&
    formPostalCode.value.trim() !== '' &&
    formEmail.value.trim() !== '' &&
    formPhone.value.trim() !== ''
  );
}

// Function to toggle the disabled class on the next button
function toggleNextButton() {
  if (doAllFieldsHaveValues()) {
    next9.classList.remove('disabled');
    console.log("removed");
  } else {
    next9.classList.add('disabled');
    console.log("added");
  }
}

// Add event listener to any form field to trigger the toggleNextButton function
document.addEventListener('input', toggleNextButton);

// Call the toggleNextButton function initially to set the initial state of the button
toggleNextButton();




// Orientation
let selectedOrientation = "";
let capacity = 0; 

for (let i = 0; i < orientationRadioButtons.length; i++) {
    orientationRadioButtons[i].addEventListener("change", function() {
        selectedOrientation = orientationRadioButtons[i].value;
        capacity = getCapacityFromOrientation(selectedOrientation);
        //console.log("Selected Orientation: " + selectedOrientation);
        //console.log("Capacity: " + capacity);
    });
}
function getCapacityFromOrientation(orientation) {
    switch (orientation) {
        case "north":
            return 0.6;
        case "south":
            return 0.95;
        case "east":
            return 0.8;
        case "west":
            return 0.8;
        default:
            return 0; 
    }
}


// Installation Additional cost
let selectedFloorCount = "";
let arialPlatformCost = 0; 


for (let i = 0; i < floorCountRadioGroup.length; i++) {
  floorCountRadioGroup[i].addEventListener("change", function() {
        selectedFloorCount = floorCountRadioGroup[i].value;
        arialPlatformCost = getarielPlatformCostfromFloorCount(selectedFloorCount);
        //console.log("Selected Floor Count: " + selectedFloorCount);
        //console.log("Aerial Plaform Cost: " + arialPlatformCost);
    });
}
function getarielPlatformCostfromFloorCount(floorcount) {
    switch (floorcount) {
        case "count1":
            return 0;
        case "count2":
            return 0;
        case "count2more":
            return 500;
        default:
            return 0; 
    }
};

let selectedYear = "";
let yearlyUsage = 1000; 
let membersOffamily = 1;
const slider1 = document.getElementById('range1');
const slider1Output = document.getElementById('value1');
const usageCheckbox = document.getElementById('usage_checkbox');
const noOfUserCon = document.getElementById('noofuers_con');
const slider2 = document.getElementById('range2');
const slider2Output = document.getElementById('value2');

function updateSlider1AndYearlyUsage() {
  switch (membersOffamily) {
    case 1:
      yearlyUsage = 1500;
      break;
    case 2:
      yearlyUsage = 3000;
      break;
    case 3:
      yearlyUsage = 3500;
      break;
    case 4:
      yearlyUsage = 4000;
      break;
    case 5:
      yearlyUsage = 4000;
      break;
    case 6:
      yearlyUsage = 4500;
      break;
    case 7:
      yearlyUsage = 5000;
      break;
    case 8:
      yearlyUsage = 5500;
      break;
    case 9:
      yearlyUsage = 6000;
      break;
    case 10:
      yearlyUsage = 7000;
      break;
    default:
      yearlyUsage = 1000; 
  }
  slider1.value = yearlyUsage;
  slider1Output.textContent = yearlyUsage;
}

slider1.addEventListener('input', function (e) {
  slider1Output.textContent = e.target.value;
  yearlyUsage = parseFloat(e.target.value); 
  const discount = getGovDiscount(selectedYear, yearlyUsage);
  //console.log("Discount: $" + discount); 
});


usageCheckbox.addEventListener('change', function() {
  if (usageCheckbox.checked) {
    noOfUserCon.style.display = 'block';
    
  } else {
    noOfUserCon.style.display = 'none';
    
  }
  if (usageCheckbox.checked) {
    updateSlider1AndYearlyUsage();
  }
});


slider2.addEventListener('input', function (e) {
  slider2Output.textContent = e.target.value;
  membersOffamily = parseFloat(e.target.value);
  if (usageCheckbox.checked) {
    updateSlider1AndYearlyUsage();
  }
  //console.log(e.target.value);
});

// Gov Discount
for (let i = 0; i < yearRadioButtons.length; i++) {
  yearRadioButtons[i].addEventListener("change", function () {
    selectedYear = yearRadioButtons[i].value;
    //console.log("Selected Year: " + selectedYear);
    yearlyUsage = parseFloat(slider1.value); 
    const discount = getGovDiscount(selectedYear, yearlyUsage);
    //console.log("Discount: $" + discount); 
  });
}

function getGovDiscount(selectedYear, yearlyUsage) {
  if (selectedYear === "before_2014") {
    const discount = (yearlyUsage / 1000) * 150;
    return discount <= 750 ? discount : 750;
  } else if (selectedYear === "after_2014") {
    return 0;
  } else {
    return 0;
  }
}

const yearUsageSubmit = document.getElementById('next8');
yearUsageSubmit.addEventListener('click', function () {
  const yearlyUsage = parseFloat(slider1.value);
  const discount = getGovDiscount(selectedYear, yearlyUsage);
  //console.log("Discount: $" + discount); 
});

//Getting Roof type
let selectedRoofType = "";
const roofTypeRadioButtons = document.getElementsByName("slope");

for (let i = 0; i < roofTypeRadioButtons.length; i++) {
    roofTypeRadioButtons[i].addEventListener("change", function () {
      selectedRoofType = roofTypeRadioButtons[i].value;
        getRoofType(selectedRoofType);
 });
};

function getRoofType(selectedRoofType) {
    //console.log("Slected roof type: " + selectedRoofType);
    return selectedRoofType;
}

//Getting roof is shaded or not
let selectedShade = "";


  for (let i = 0; i < roofShadeRadioButtons.length; i++) {
    roofShadeRadioButtons[i].addEventListener("change", function () {
      selectedShade = roofShadeRadioButtons[i].value;
        getShadeType(selectedShade);
    });
  };

  function getShadeType(selectedShade) {
    //console.log("Slected roof type: " + selectedShade);
    return selectedShade;
  }


function renewBeCalculater() {
  const capacity = getCapacityFromOrientation(selectedOrientation);
  const noOfPanels = yearlyUsage / (405 * capacity);
  const finalNoOfPanels = Math.round(noOfPanels);
  const arialPlatformCost = getarielPlatformCostfromFloorCount(selectedFloorCount);
  const discountAmount = getGovDiscount(selectedYear, yearlyUsage);
  const roofTypeSelection = selectedRoofType;
  const roofShadeSelection = selectedShade;
  let panelCost;

  // Find the index in pannelData for the given number of panels
  const panelIndex = pannelData.findIndex(item => item["Amount of Solar Panels"] === finalNoOfPanels);

  if (panelIndex !== -1) {

  // Determine the roof type and shade selection
  const roofType = roofTypeSelection === "tilted" ? "Tilted" : "Flat";
  const shadeSelection = roofShadeSelection === "yes" ? "Micro (x4)" : "String";

  // Get the panel cost based on the roof type and shade selection
  panelCost = parseFloat(pannelData[panelIndex][roofType][shadeSelection]);

  //console.log("Panel Cost:", panelCost);
   } else {
  //console.log("Panel data not found for the given number of panels.");
  }

  // Pannel installation price
  const instalationwithoutdiscount = panelCost + arialPlatformCost;
  const installationCost = panelCost + arialPlatformCost - discountAmount;

  //Yearly electrycity price
  const yearlyElectricityCost = yearlyUsage * 0.31; 

  //Payback period
  const payBackPeriod = installationCost/ yearlyElectricityCost;
  const payBackPeriodFinal = Math.round(payBackPeriod);
  
  // Savings in 25 Years
  const savingin25Years = (25 - payBackPeriod)*yearlyElectricityCost;
  const savingin25YearsFinal = Math.round(savingin25Years);
  
  //Energy Savings in 25 Years
  const energySavingsIn25Years = (25 - payBackPeriod) * yearlyUsage;
  const energySavingsIn25YearsFinal = Math.round(energySavingsIn25Years);
  
      var formData = {
        payBackPeriod: payBackPeriod,
        noOfPanels: noOfPanels,
        selectedShade: selectedShade,
        selectedRoofType: selectedRoofType,
        panelCost: panelCost,
        selectedOrientation: selectedOrientation,
        savingin25Years: savingin25Years,
        energySavingsIn25Years: energySavingsIn25Years,
        yearlyElectricityCost: yearlyElectricityCost,
        instalationwithoutdiscount: instalationwithoutdiscount,
        discountAmount: discountAmount,
        installationCost: installationCost,
        arialPlatformCost: arialPlatformCost,
        }; 
  sessionStorage.setItem("formData", JSON.stringify(formData));

}

 const lasSubmit = document.getElementById('next9');
  lasSubmit.addEventListener("click", renewBeCalculater);


</script>